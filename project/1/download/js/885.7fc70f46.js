"use strict";(self["webpackChunkbk_pc"]=self["webpackChunkbk_pc"]||[]).push([[885],{40885:function(e,l,a){a.r(l),a.d(l,{default:function(){return N}});a(21703),a(57658);var t=a(73396),o=a(44870),s=a(87139),u=a(95410),i=a.n(u),n=a(22483),r=a(47178),d=a(40130),m=a(60814),c=a(61073),p=a(44161),f=a(72748),v=a(44775);const g=["src"],y={class:"el-upload-list__item-actions"},w=["onClick"],_=["onClick"],k=["onClick"],b=["src"];var h={__name:"CommodityImgUpload",props:{imgList:Array},emits:["delImg"],setup(e,{expose:l,emit:a}){const s=e,u=(0,o.ref)({moduleName:"goods"}),i=(0,o.ref)(`${c.O9}/normal/uploadimg!execute.action`),n=(0,o.ref)(""),d=(0,o.ref)(!1),m=(0,o.ref)(!1),p=(0,o.ref)([]),h=e=>{const l=p.value.findIndex((l=>l.uid===e.uid));a("delImg",p.value[l]),p.value.splice(l,1)},W=()=>{p.value=[]};(0,t.bv)((()=>{p.value=s.imgList}));const C=e=>{n.value=e.url,d.value=!0};l({fileList:p,removeFileList:W});const $=e=>{},U=()=>{D.value.close()},x=e=>{D.value.close(),"0"===e.code?(0,r.z8)({message:"图片添加成功",type:"success"}):(0,r.z8)({message:e.msg,type:"error"}),a("addImg",e.data)},D=(0,o.ref)(null),S=()=>{D.value=v.kN.service({lock:!0,text:"上传图片中",background:"rgba(0, 0, 0, 0.7)"}),a("beforeUpload")};return(e,l)=>{const a=(0,t.up)("el-icon"),s=(0,t.up)("el-upload"),r=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(s,{"file-list":p.value,"onUpdate:fileList":l[0]||(l[0]=e=>p.value=e),limit:9,data:u.value,action:i.value,"list-type":"picture-card","on-error":U,"on-success":x,"before-upload":S},{file:(0,t.w5)((({file:e})=>[(0,t._)("div",null,[(0,t._)("img",{class:"el-upload-list__item-thumbnail",src:e.url,alt:""},null,8,g),(0,t._)("span",y,[(0,t._)("span",{class:"el-upload-list__item-preview",onClick:l=>C(e)},[(0,t.Wm)(a,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.unref)(f.DYM))])),_:1})],8,w),m.value?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("span",{key:0,class:"el-upload-list__item-delete",onClick:l=>$(e)},[(0,t.Wm)(a,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.unref)(f.UWx))])),_:1})],8,_)),m.value?(0,t.kq)("",!0):((0,t.wg)(),(0,t.iD)("span",{key:1,class:"el-upload-list__item-delete",onClick:l=>h(e)},[(0,t.Wm)(a,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.unref)(f.HG3))])),_:1})],8,k))])])])),default:(0,t.w5)((()=>[(0,t.Wm)(a,null,{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.unref)(f.v37))])),_:1})])),_:1},8,["file-list","data","action"]),(0,t.Wm)(r,{modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=e=>d.value=e)},{default:(0,t.w5)((()=>[(0,t._)("img",{style:{width:"100%"},src:n.value,alt:"Preview Image"},null,8,b)])),_:1},8,["modelValue"])],64)}}};const W=h;var C=W;const $={class:"commodity-library"},U={class:"select-wrapper"},x={style:{padding:"5px"}},D={style:{padding:"5px"}},S={class:"my-30"},V={class:"result"},z={class:"font-14"},L={class:"content",style:{"text-align":"left"}},O={class:"flex"},j={style:{padding:"5px"}},I={style:{padding:"5px"}},E={class:"flex justify-center mt-40"},G={class:"img-upload-tips"},q={style:{color:"#333"}},Z={class:"dialog-footer"},F={class:"comment-content"},H={key:0,class:"comment-img-wrapper"},Y={class:"dialog-footer"};var A={__name:"Comment",setup(e){const l=(0,n.yj)(),a=(0,n.tv)(),u=(0,o.ref)(""),f=(0,o.ref)(null),v=l.query.id||"",g=((0,o.ref)("en"),(0,o.ref)([{value:"全部",label:"全部"},{value:"好评",label:"好评"},{value:"中评",label:"全部"},{value:"差评",label:"差评"}]),(0,o.ref)([{value:"",label:"全部"},{value:"1",label:"禁用"},{value:"0",label:"启用"}])),y=(0,o.ref)({user:"",status:"",score:""}),w=e=>{Object.keys(e).forEach((l=>e[l]="")),k.systemGoodId=v,k.status=!1,W.value=0,f.value.removeFileList()},_=(0,o.ref)(null),k=(0,o.reactive)({score:"",content:"",status:!1,systemGoodId:v}),b=(e,l,a)=>{l/1>5||l/1<1||-1!==l.indexOf(".")?a(new Error("请输入1-5分, 不能有小数")):a()},h=(0,o.reactive)({score:[{required:!0,message:"请输入会员评分",trigger:"change"},{validator:b,trigger:"change"}],content:[{required:!0,message:"请输入评论内容",trigger:"change"}],createTime:[{type:"date",required:!0,message:"请选择时间",trigger:"change"}]}),W=(0,o.ref)(0),A=e=>{W.value++,k["imgUrl"+W.value]=e,T.value=!1},T=(0,o.ref)(!1),B=()=>{T.value=!0},N=async e=>{e&&await e.validate(((l,a)=>{l&&(K(),R(e))}))},R=e=>{e&&e.resetFields()},K=()=>{k.status=k.status?1:0;const e=be(k);(0,p.Z)({method:"post",url:`${c.O9}/systemGoods/addUpdateSystemComment.action`,data:e}).then((e=>{ie.value=!1,ae(),w(k)}))},P=(0,o.ref)(1),M=(0,o.ref)(20),Q=(0,o.ref)(0),J=()=>{ae()},X=(0,o.ref)([]),ee=(0,o.ref)(0),le=(0,o.ref)(!1),ae=()=>{le.value=!0;let e={pageNum:P.value,pageSize:M.value,status:y.value.status,systemGoodId:v};e.status||delete e.status,(0,p.Z)({method:"post",url:`${c.O9}/systemGoods/listSystemComment.action?`+i().stringify(e)}).then((e=>{le.value=!1,Q.value=e.data.data.totalElements;const l=e.data.data.elements;l.forEach((e=>{const l=Object.keys(e);e.status=e.status/1===1,l.forEach((l=>{l.indexOf("imgUrl")>-1&&e[l]&&ee.value++})),e.imgCount=ee.value,ee.value=0})),X.value=l}))};ae();const te=()=>{ae()},oe=(0,o.ref)([]),se=e=>{oe.value=[],e.forEach((e=>{oe.value.push(e.id)}))},ue=()=>{0!==oe.value.length?ye(oe.value):(0,r.z8)({message:"请选择要删除的评论",type:"warning",duration:3e3})},ie=(0,o.ref)(!1),ne=()=>{},re=(0,o.ref)(!1),de=(0,o.ref)({}),me=e=>{const l={...e,imgList:[]};Object.keys(e).forEach((a=>{a.indexOf("imgUrl")>-1&&e[a]&&l.imgList.push(e[a])})),de.value=l,re.value=!0},ce=()=>{},pe=()=>{Object.keys(y.value).forEach((e=>{y.value[e]=""}))},fe=((0,o.ref)(""),(0,o.ref)(!1)),ve=()=>{ae()},ge=(0,o.ref)(!1),ye=e=>{d.T.confirm("你确定要删除吗?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{we(e).then((e=>{ge.value=!1,(0,r.z8)({type:"success",message:"删除成功"}),ae()}))})).catch((()=>{(0,r.z8)({type:"info",message:"取消删除"})}))},we=e=>{Array.isArray(e)||(e=[e]),e=e.join(","),ge.value=!0;const l=be({id:e});return(0,p.Z)({method:"post",url:`${c.O9}/systemGoods/deleteSystemComment.action`,data:l})},_e=e=>{w(k),ie.value=!1,R(e)},ke=e=>{const l=e.status?1:0;(0,p.Z)({method:"post",url:`${c.O9}/systemGoods/updateSystemCommentStatus.action?id=${e.id}&status=${l}`}).then((e=>{ae()}))},be=e=>{const l=new FormData;for(const a in e)l.append(a,e[a]);return l};return(e,l)=>{const i=(0,t.up)("el-button"),n=(0,t.up)("el-option"),r=(0,t.up)("el-select"),d=(0,t.up)("el-form-item"),c=(0,t.up)("el-form"),p=(0,t.up)("el-table-column"),v=(0,t.up)("el-switch"),w=(0,t.up)("el-table"),b=(0,t.up)("el-pagination"),W=(0,t.up)("el-config-provider"),T=(0,t.up)("el-input"),R=(0,t.up)("el-dialog"),K=(0,t.up)("el-image"),ee=(0,t.Q2)("loading");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",$,[(0,t.Wm)(i,{style:{"margin-bottom":"10px"},type:"primary",onClick:l[0]||(l[0]=e=>(0,o.unref)(a).go(-1))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.toDisplayString)(e.$t("返回")),1)])),_:1}),(0,t._)("div",U,[(0,t.Wm)(c,{class:"flex mt-10","label-width":"120px"},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{label:"状态："},{default:(0,t.w5)((()=>[(0,t.Wm)(r,{modelValue:y.value.status,"onUpdate:modelValue":l[1]||(l[1]=e=>y.value.status=e),class:"m-2",placeholder:"状态"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(g.value,(e=>((0,t.wg)(),(0,t.j4)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(d,null,{default:(0,t.w5)((()=>[(0,t._)("div",x,[(0,t.Wm)(i,{type:"primary",onClick:ve,loading:fe.value},{default:(0,t.w5)((()=>[(0,t.Uk)("查询")])),_:1},8,["loading"])]),(0,t._)("div",D,[(0,t.Wm)(i,{type:"primary",onClick:pe},{default:(0,t.w5)((()=>[(0,t.Uk)("重置")])),_:1})])])),_:1})])),_:1})]),(0,t._)("div",S,[(0,t.Wm)(i,{type:"primary",onClick:l[2]||(l[2]=e=>{ie.value=!0,u.value="新增评论"})},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.toDisplayString)(e.$t("新增评论")),1)])),_:1}),(0,t.Wm)(i,{type:"danger",style:{"margin-left":"12px"},onClick:ue},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.toDisplayString)(e.$t("批量删除")),1)])),_:1})]),(0,t._)("div",V,[(0,t._)("div",z,(0,s.toDisplayString)(e.$t("查询结果")),1),(0,t.wy)(((0,t.wg)(),(0,t.j4)(w,{class:"mt-15",onSelectionChange:se,data:X.value,border:"",style:{width:"100%"}},{default:(0,t.w5)((()=>[(0,t.Wm)(p,{type:"selection",width:"55"}),(0,t.Wm)(p,{prop:"score",label:e.$t("评分"),width:"80"},null,8,["label"]),(0,t.Wm)(p,{prop:"img",label:e.$t("图片"),width:"120"},{default:(0,t.w5)((e=>[(0,t.Uk)((0,s.toDisplayString)(e.row.imgCount||0)+" 张 ",1)])),_:1},8,["label"]),(0,t.Wm)(p,{label:e.$t("评价内容")},{default:(0,t.w5)((e=>[(0,t._)("div",L,(0,s.toDisplayString)(e.row.content),1)])),_:1},8,["label"]),(0,t.Wm)(p,{label:e.$t("禁用评论"),width:"180"},{default:(0,t.w5)((e=>[(0,t.Wm)(v,{modelValue:e.row.status,"onUpdate:modelValue":l=>e.row.status=l,onChange:l=>ke(e.row),style:{"margin-left":"10px"}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1},8,["label"]),(0,t.Wm)(p,{label:e.$t("操作"),width:"300"},{default:(0,t.w5)((l=>[(0,t._)("div",O,[(0,t._)("div",j,[(0,t.Wm)(i,{onClick:e=>me(l.row)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.toDisplayString)(e.$t("查看评价")),1)])),_:2},1032,["onClick"])]),(0,t._)("div",I,[(0,t.Wm)(i,{type:"danger",onClick:e=>ye(l.row.id)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.toDisplayString)(e.$t("删除")),1)])),_:2},1032,["onClick"])])])])),_:1},8,["label"])])),_:1},8,["data"])),[[ee,le.value]])]),(0,t._)("div",E,[(0,t.Wm)(W,{locale:(0,o.unref)(m.Z)},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{onSizeChange:te,"current-page":P.value,"onUpdate:currentPage":l[3]||(l[3]=e=>P.value=e),"page-size":M.value,"onUpdate:pageSize":l[4]||(l[4]=e=>M.value=e),"page-sizes":[10,20,30,50],background:"",layout:"total, prev, pager, next, jumper",total:Q.value,onCurrentChange:J},null,8,["current-page","page-size","total"])])),_:1},8,["locale"])])]),(0,t.Wm)(R,{"show-close":!1,modelValue:ie.value,"onUpdate:modelValue":l[10]||(l[10]=e=>ie.value=e),title:e.$t(u.value),width:"44%","before-close":ne},{footer:(0,t.w5)((()=>[(0,t._)("span",Z,[(0,t.Wm)(i,{type:"primary",onClick:l[8]||(l[8]=e=>N(_.value))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.toDisplayString)(e.$t("确定")),1)])),_:1}),(0,t.Wm)(i,{style:{"margin-left":"12px"},onClick:l[9]||(l[9]=e=>_e(_.value))},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.toDisplayString)(e.$t("取消")),1)])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(c,{ref_key:"ruleFormRef",ref:_,model:k,rules:h},{default:(0,t.w5)((()=>[(0,t.Wm)(d,{class:"img-upload",label:e.$t("评论图片：")},{default:(0,t.w5)((()=>[(0,t.Wm)((0,o.unref)(C),{ref_key:"imgLoad",ref:f,onAddImg:A,onBeforeUpload:B},null,512),(0,t._)("div",G,(0,s.toDisplayString)(e.$t("tips")),1)])),_:1},8,["label"]),(0,t.Wm)(d,{class:"img-upload",label:`${e.$t("评价内容")}：`,prop:"content"},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{modelValue:k.content,"onUpdate:modelValue":l[5]||(l[5]=e=>k.content=e),autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:e.$t("评价内容")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,t.Wm)(d,{class:"img-upload",label:`${e.$t("会员评分")}：`,prop:"score"},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{type:"number",modelValue:k.score,"onUpdate:modelValue":l[6]||(l[6]=e=>k.score=e),placeholder:e.$t("请输入1-5分"),min:"1",max:"5"},{suffix:(0,t.w5)((()=>[(0,t._)("span",q,(0,s.toDisplayString)(e.$t("分")),1)])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),(0,t.Wm)(d,{label:`${e.$t("禁用评论")}：`},{default:(0,t.w5)((()=>[(0,t.Wm)(v,{modelValue:k.status,"onUpdate:modelValue":l[7]||(l[7]=e=>k.status=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),(0,t.Wm)(R,{"show-close":!1,modelValue:re.value,"onUpdate:modelValue":l[13]||(l[13]=e=>re.value=e),title:e.$t("评论详情"),width:"40%","before-close":ce},{footer:(0,t.w5)((()=>[(0,t._)("span",Y,[(0,t.Wm)(i,{type:"primary",onClick:l[11]||(l[11]=e=>re.value=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.toDisplayString)(e.$t("确定")),1)])),_:1}),(0,t.Wm)(i,{style:{"margin-left":"12px"},onClick:l[12]||(l[12]=e=>re.value=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)((0,s.toDisplayString)(e.$t("取消")),1)])),_:1})])])),default:(0,t.w5)((()=>[(0,t._)("div",null,(0,s.toDisplayString)(de.value.score)+"分",1),(0,t._)("div",F,(0,s.toDisplayString)(de.value.content),1),de.value.imgList.length>0?((0,t.wg)(),(0,t.iD)("div",H,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(de.value.imgList,(e=>((0,t.wg)(),(0,t.j4)(K,{key:e,src:e,fit:"cover","preview-src-list":de.value.imgList},null,8,["src","preview-src-list"])))),128))])):(0,t.kq)("",!0)])),_:1},8,["modelValue","title"])],64)}}},T=a(40089);const B=(0,T.Z)(A,[["__scopeId","data-v-1afe3f94"]]);var N=B}}]);