(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-55a26a12"],{5880:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD8AAAA9CAMAAAAtSUHmAAAAkFBMVEVHcEyqqqqqqqqfn5+qqqqrq6uvr6+np6epqamqqqqqqqqnp6epqamrq6uqqqqvr6+qqqqqqqqpqampqampqamqqqqpqamsrKytra2rq6uoqKinp6ewsLCrq6uqqqqsrKynp6epqamgoKCoqKioqKiurq6qqqqvr6+pqamqqqqrq6usrKyoqKiysrKpqamqqqrtr4W8AAAAL3RSTlMA788Q/r8gIN7fAUCAQK8QnzCPX99gv18BgHAhAX/On0GfEbCPAWEhoO5QYJABUEDUE8cAAAFhSURBVEjH7dbJYoMgEAZgQCkFrUu2Zk+67/X9366urSgTZ2oPPeQ/GeQjOijI2Dn/M+ogf5IoMtdZO1qN4tQBepw2gINTBnBy/AAAHxzgokoK8XyAtO7Tx96OZ/jo664XGS0Hm+8yauwr0GQv2zyGes1mUFm4NWXOHmHgFZUNnp1XN+D5tHU+5FQfeUPP1Ekfduc3jij+vf+AxQLvtddubvpwtP9kDs/WWL9gTs840k8BHyK9B/gA50XRctWpturdAOgXoNcon4BeoPzdyP+v7t8vUv4ujwj3X9Vf5akKXhyVPEXOXwDM3xrpJeA19vk/Ov0c/f4IUzeXpav7bDT+/Z807U3pGPuIKOvPynSWj4eEtv5Nlha/jajrr37dfp9ePmry+p1X8W1jjNmap9Vv1v9qE5BSQBsQxp/KX/qYzq39k0myTywfULnf+ZYKfRJ/mfe+2m72l9js7xU755zx+QJXpCjUIJCVfgAAAABJRU5ErkJggg=="},82305:function(e,t,a){a("e884")},e884:function(e,t,a){},fbb2:function(e,t,a){a.r(t),a("14d9");var s=a("2f62"),i=a("4260"),o=a("365c"),r=(s={name:"order-evaluation-dialog",props:{value:{type:Boolean,default:!1},refresh:{type:Function}},data(){return{orderId:this.$route.query.orderId,loading:!1,rateMap:{},contentMap:{},imagesMap:{},resultMap:{},dialogImageUrl:"",isUpload:!1,dialogVisible:!1,disabled:!1,UploadApi:o.U,uploadParams:{moduleName:"evaluate",token:localStorage.getItem("ES_TOKEN")}}},mounted(){this.orderId&&this.requestData()},computed:{...Object(s.c)({orderGoods:"order/orderGoods"})},watch:{orderGoods(e){let t={},a={},s={};e.forEach(e=>{t[e.goodsId]=5,a[e.goodsId]="",s[e.goodsId]=!1}),this.rateMap={...t},this.contentMap={...a},this.resultMap={...s}}},methods:{...Object(s.b)({requestOrderGoodsList:"order/requestOrderGoodsList",requestOrderEvaluationList:"order/requestOrderEvaluationList"}),uploadFile(e,t){},handleRemove(e,t){var a=null==(a=this.imagesMap[t])?void 0:a.findIndex(t=>t.uid==e.uid);0<=a&&null!=(t=this.imagesMap[t])&&t.splice(a,1)},handlePictureCardPreview(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},handleFilesChange(e,t){8<e.length?(this.$message.warning(this.$t("message.home.最多上传9张图片")),this.isUpload=!0):this.imagesMap[t]=e},goBack(){this.$router.push("/userInfo/my-order")},getRate(e){return this.rateMap[e]<2?3:this.rateMap[e]<4?2:1},async requestData(){try{this.loading=!0,await this.requestOrderGoodsList({orderId:this.orderId})}finally{this.loading=!1}},async submit(){try{this.btnLoading=!0,this.disabled=!0;var e,t=[];for({goodsId:e}of this.orderGoods){var a,s,i={sellerGoodsId:e,evaluationType:this.getRate(e),rating:this.rateMap[e],content:this.contentMap[e]},r=null==(a=this.imagesMap[e])?void 0:a.filter(e=>!e.response);if(r&&0<r.length)return void this.$message({message:this.$t("message.home.evaluationUploading"),type:"error"});if(!this.contentMap)return void this.$message({message:this.$t("message.home.请填写评论内容"),type:"error"});var d=(null==(s=this.imagesMap[e])?void 0:s.filter(e=>e.response&&"0"==e.response.code).map(e=>e.response.data))||[];for(let e=0;e<d.length;e++)i["imgUrl"+(e+1)]=d[e];t.push(i)}0==(await Object(o.a)({orderId:this.orderId,evaluationAdds:t})).code&&(this.$router.push({path:"/userInfo/my-order",replace:!0}),this.$notify({title:this.$t("message.home.successTips"),message:this.$t("message.home.evaluateOrderSuccess"),type:"success"}))}finally{this.btnLoading=!1,this.disabled=!1}},numberFormatFn(e){return Object(i.f)(e)}}},a("82305"),a("2877"));r=Object(r.a)(s,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"evaluation-list",staticStyle:{width:"866px","margin-top":"24px"}},[t("div",{staticClass:"page-title",staticStyle:{cursor:"pointer","margin-bottom":"20px","margin-left":"34px"},on:{click:e.goBack}},[t("i",{staticClass:"el-icon-arrow-left"}),e._v(" "+e._s(e.$t("message.home.myOrder"))+"/"+e._s(e.$t("message.home.Submitareview"))+" ")]),e._l(e.orderGoods,(function(s,i){return t("div",{key:s.id,staticClass:"evaluation-item"},[t("div",{staticStyle:{"margin-left":"40px","margin-top":"30px"}},[t("div",{staticClass:"product-item"},[t("el-image",{staticStyle:{width:"62px",height:"62px"},attrs:{fit:"scale-down",src:s.goodsIcon,alt:"order-detail-product"}}),t("div",{staticClass:"info"},[t("div",{staticClass:"tit"},[e._v(e._s(s.goodsName))]),s.attributes&&0<s.attributes.length?t("div",{staticStyle:{"margin-top":"9px","font-size":"12px"}},[e._v(" "+e._s(s.attributes.map(e=>e.attrName+":"+e.attrValue).join(" "))+" ")]):e._e(),t("div",{staticClass:"price"},[e._v("$"+e._s(e.numberFormatFn(s.goodsReal)))]),t("el-rate",{attrs:{disabled:e.resultMap[s.goodsId]},model:{value:e.rateMap[s.goodsId],callback:function(t){e.$set(e.rateMap,s.goodsId,t)},expression:"rateMap[item.goodsId]"}})],1)],1),t("el-input",{staticClass:"content",attrs:{type:"textarea",placeholder:e.$t("message.home.evaluateOrderPlaceholder"),resize:"none",disabled:e.resultMap[s.goodsId],maxlength:1e3,"show-word-limit":""},model:{value:e.contentMap[s.goodsId],callback:function(t){e.$set(e.contentMap,s.goodsId,t)},expression:"contentMap[item.goodsId]"}}),t("div",{staticStyle:{height:"15px"}}),t("span",[e._v(e._s(e.$t("message.home.evaluateInput")))]),t("el-upload",{staticStyle:{"margin-top":"10px"},attrs:{data:e.uploadParams,action:e.UploadApi,"on-change":(t,a)=>e.handleFilesChange(a,s.goodsId),"list-type":"picture-card",disabled:e.isUpload},scopedSlots:e._u([{key:"file",fn:function({file:a}){return t("div",{},[t("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:a.url,alt:""}}),t("span",{staticClass:"el-upload-list__item-actions"},[t("span",{staticClass:"el-upload-list__item-preview",on:{click:function(t){return e.handlePictureCardPreview(a)}}},[t("i",{staticClass:"el-icon-zoom-in"})]),e.disabled?e._e():t("span",{staticClass:"el-upload-list__item-delete",on:{click:function(t){return e.handleRemove(a,s.goodsId)}}},[t("i",{staticClass:"el-icon-delete"})])])])}}],null,!0)},[t("img",{staticStyle:{width:"25.54px",height:"22.81px"},attrs:{src:a("5880")}})])],1),i<e.orderGoods.length-1?t("el-divider"):e._e()],1)})),t("div",{staticClass:"action"},[t("el-button",{attrs:{disabled:e.disabled},on:{click:e.submit}},[e._v(" "+e._s(e.$t("message.home.Submitareview"))+" ")])],1),t("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],2)}),[],!1,null,"6daf21fa",null);t.default=r.exports}}]);