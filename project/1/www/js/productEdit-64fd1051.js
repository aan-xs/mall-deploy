import{D as me,K as ve,$ as L,d as pe,bK as fe,a9 as be,e as s,O as ge,P as he,_ as Te,j as Ce,m as B,i as _e,u as xe,ai as ye,l as Se,r as h,bF as M,q as ke,g as H,p as Ve,I as Pe,bq as $e,c as U,w as g,a as u,y as i,n as we,b as T,T as r,b1 as Ne,o as w,t as p,f as J,z as De,V as Ie,al as Fe,R as Be,S as Me}from"./index-d71e1836.js";import{B as Ue}from"./index-2b37af5f.js";import"./index-bb63e648.js";import{C as Oe}from"./index-9f084461.js";import"./index-27d29771.js";import{F as Re}from"./index-ac66dd73.js";import{s as Ee,b as Ye,d as ze}from"./product.api-4494d699.js";import{D as Ge}from"./index-bdd8c117.js";import{F as je}from"./index-9cb38fbf.js";import{D as te}from"./function-call-3e6c5181.js";import"./use-id-7082c426.js";import"./index-43614c31.js";import"./stringify-da9bcf3c.js";import"./___vite-browser-external_commonjs-proxy-74327c81.js";const[qe,A]=me("switch"),Le={size:ve,loading:Boolean,disabled:Boolean,modelValue:L,activeColor:String,inactiveColor:String,activeValue:{type:L,default:!0},inactiveValue:{type:L,default:!1}};var He=pe({name:qe,props:Le,emits:["change","update:modelValue"],setup(c,{emit:N,slots:x}){const k=()=>c.modelValue===c.activeValue,O=()=>{if(!c.disabled&&!c.loading){const l=k()?c.inactiveValue:c.activeValue;N("update:modelValue",l),N("change",l)}},R=()=>{if(c.loading){const l=k()?c.activeColor:c.inactiveColor;return s(ge,{class:A("loading"),color:l},null)}if(x.node)return x.node()};return fe(()=>c.modelValue),()=>{var l;const{size:E,loading:V,disabled:n,activeColor:D,inactiveColor:e}=c,P=k(),y={fontSize:be(E),backgroundColor:P?D:e};return s("div",{role:"switch",class:A({on:P,loading:V,disabled:n}),style:y,tabindex:n?void 0:0,"aria-checked":P,onClick:O},[s("div",{class:A("node")},[R()]),(l=x.background)==null?void 0:l.call(x)])}}});const Je=he(He);const oe=c=>(Be("data-v-47e02415"),c=c(),Me(),c),Ae={class:"editProduct"},Ke={class:"tip pt-2 pb-2 pl-4 pr-4"},Qe={class:"profit"},We={key:0,class:"flex pl-4 pr-4 input-item pt-3 pb-3"},Xe={class:"flex"},Ze={class:"flex pl-4 pr-4 input-item pt-3 pb-3"},et={class:"flex"},tt={class:"flex pl-4 pr-4 input-item pt-3 pb-3"},ot={class:"flex"},lt={class:"tip pt-2 pb-2 pl-4 pr-4"},at=oe(()=>u("span",null,"%",-1)),nt={class:"tips pt-2 pb-2 pl-4 pr-4"},it={class:"tip pt-2 pb-2 pl-4 pr-4"},st={class:"tip pt-2 pb-2 pl-4 pr-4"},ut={class:"tip pt-2 pb-2 pl-4 pr-4"},rt=oe(()=>u("span",null,"%",-1)),ct={style:{margin:"16px"},class:"pb-8"},dt={__name:"productEdit",setup(c){const N="sm",x=Ce(),k=B(()=>{}),O=B(()=>{}),R=_e(),{t:l}=xe(),E=ye(),V=Se(),n=h(JSON.parse(E.query.item)),D=h(new Date),e=h({sellingPrice:"",isShelf:0,recTime:0,isCombo:!1,startTime:M(),endTime:M(),discount:"",percent:"",profit:"",id:""}),P=()=>{te.confirm({title:l("product.21"),message:l("product.22"),confirmButtonText:l("sure"),cancelButtonText:l("cancel")}).then(()=>{ze({sellerGoodsId:e.value.id}).then(()=>{sessionStorage.setItem("currentProductId",n.value.id),sessionStorage.setItem("productDelete",!0),r(l("product.10")),V.go(-1)})}).catch(()=>{})},y=h(!1),$=h(!1),Y=h(!1),I=h(""),z=h(""),le=h(""),G=B(()=>{let t={};return x.userInfo.token?t={...x.userInfo}:V.push("/login"),t});ke(()=>{ie()}),H(()=>e.value.percent,(t,o)=>{}),H(()=>e.value.isCombo,(t,o)=>{t&&(console.log("\u5F00\u5173\u6253\u5F00"),ae())}),H(()=>e.value.isShelf,(t,o)=>{console.log("\u5F00\u5173\u6253\u5F00",t),t/1===1&&ne()});const C=h(!1),ae=()=>{C.value=!0,F()},S=h(!1),ne=()=>{S.value=!0,F()},d=Ve({min:"",max:""}),ie=()=>{e.value.id=n.value.id,e.value.discountPrice=n.value.discountPrice?(n.value.discountPrice/1).toFixed(2):(n.value.sellingPrice/1).toFixed(2),e.value.sellingPrice=(n.value.sellingPrice/1).toFixed(2),e.value.isShelf=n.value.isShelf/1,e.value.isCombo=Boolean(n.value.isCombo/1),e.value.recTime=n.value.recTime/1,e.value.startTime=n.value.discountStartTime?n.value.discountStartTime.split(" ")[0]:n.value.discountStartTime,e.value.endTime=n.value.discountEndTime?n.value.discountEndTime.split(" ")[0]:n.value.discountEndTime,e.value.profit=(n.value.profitRatio*100).toFixed(2),e.value.discount=(n.value.discountRatio*100).toFixed(2),e.value.systemPrice=(n.value.systemPrice/1).toFixed(2),e.value.percent=(n.value.profitRatio/1*100).toFixed(2),d.min=Number(n.value.sysParaMin),d.max=Number(n.value.sysParaMax),Ee().then(t=>{d.min=Number(t.sysParaMin),d.max=Number(t.sysParaMax)})},se=()=>{if([].includes(N))if(G.value.phoneverif&&G.value.emailverif)F();else{const t=G.value.phoneverif?"bindEmailTips":"\u8BF7\u7ED1\u5B9A\u624B\u673A\u53F7";te.confirm({title:l("dialogTips"),message:l(t),cancelButtonText:l("cancel"),confirmButtonText:l("gotoSet"),confirmButtonColor:"#1552F0",cancelButtonColor:"#999"}).then(()=>{Fe("/personalInfo")}).catch(()=>{console.log("cancel")})}else F()},F=()=>{const{startTime:t,endTime:o,discount:f}=e.value;if(t||o){const m=new Date(t.replace(/-/g,"/")+" 00:00:00").getTime(),b=new Date(o.replace(/-/g,"/")+" 00:00:00").getTime();if(!f){C.value=!1,S.value=!1,e.value.isCombo=!1,e.value.isShelf=!1,r(l("\u8BF7\u8BBE\u7F6E\u6298\u6263\u6BD4\u4F8B"));return}if(m>b){C.value=!1,S.value=!1,e.value.isCombo=!1,e.value.isShelf=!1,r(l("\u5F00\u59CB\u65F6\u95F4\u5E94\u5C0F\u4E8E\u7ED3\u675F\u65F6\u95F4"));return}}if(Number(f)&&(!t||!o)){C.value=!1,S.value=!1,e.value.isCombo=!1,e.value.isShelf=!1,r(l("\u8BF7\u6B63\u786E\u586B\u5199\u6D3B\u52A8\u5F00\u542F\u65F6\u95F4\u548C\u7ED3\u675F\u65F6\u95F4"));return}if(!X()){r.loading({forbidClick:!0,loadingType:"spinner",duration:0});let m={isShelf:e.value.isShelf?1:0,recTime:e.value.recTime?1:0,isCombo:e.value.isCombo?1:0,sellerGoodsId:n.value.id,startTime:e.value.startTime?e.value.startTime+" 00:00:00":"",endTime:e.value.endTime?e.value.endTime+" 00:00:00":"",discount:(e.value.discount/100).toFixed(2),percent:(e.value.percent/100).toFixed(2),profit:(e.value.percent/100).toFixed(2)};return Ye(m).then(b=>{sessionStorage.setItem("currentProductId",n.value.id),C.value?C.value=!1:S.value?S.value=!1:(r(l("product.10")),V.push("/product"))}).catch(b=>{const v=b.msg;if(C.value=!1,S.value=!1,v.indexOf("\u672A\u8D2D\u4E70")>-1)r(l("\u60A8\u6682\u672A\u8D2D\u4E70\u76F4\u901A\u8F66\u5957\u9910\uFF0C\u8BF7\u8D2D\u4E70\u518D\u8BD5"));else if(v.indexOf("\u5DF2\u5230\u671F")>-1)r(l("\u60A8\u7684\u76F4\u901A\u8F66\u5DF2\u5230\u671F"));else if(v.indexOf("\u6700\u591A\u63A8\u5E7F")>-1){const _=v.split("\u6700\u591A\u63A8\u5E7F\u5546\u54C1\u6570\u91CF\u4E3A");r(l("\u6700\u591A\u63A8\u5E7F\u5546\u54C1\u6570\u91CF\u4E3A")+": "+_[1])}else if(v.indexOf("\u672A\u6FC0\u6D3B")>-1)r(l("\u60A8\u7684\u76F4\u901A\u672A\u6FC0\u6D3B"));else if(v.indexOf("\u672A\u6FC0\u6D3B")>-1)r(l("\u60A8\u7684\u76F4\u901A\u672A\u6FC0\u6D3B"));else if(v.indexOf("\u6700\u5C0F\u4E0B\u67B6")>-1)r(l("\u5C11\u4E8E\u5E97\u94FA\u8BBE\u7F6E\u6700\u5C0F\u4E0B\u67B6\u5546\u54C1\u6570"));else if(v.indexOf("\u9996\u6B21\u4E0A\u67B6")>-1){const _=typeof b.data=="string"?JSON.parse(b.data):b.data;r(l(v,{_$1:_._$1}))}else r(l(v));e.value.isCombo=!1})}},K=t=>{switch(t){case 1:y.value=!0;break;case 2:$.value=!0;break;case 3:Y.value=!0;break}},Q=t=>{switch(console.log(I.value),t){case 1:y.value=!1,e.value.startTime=M(I.value).format("YYYY-MM-DD");break;case 2:$.value=!1,e.value.endTime=M(z.value).format("YYYY-MM-DD");break;case 3:Y.value=!1,e.value.recTime=ue(le.value);break}},W=t=>{switch(t){case 1:y.value=!1;break;case 2:$.value=!1;break;case 3:Y.value=!1;break}},ue=t=>{let o=t.getFullYear(),f=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,m=t.getDate()<10?"0"+t.getDate():t.getDate(),b=t.getHours()<10?"0"+t.getHours():t.getHours(),v=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),_=t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return o+"-"+f+"-"+m+" "+b+":"+v+":"+_},re=B(()=>{let t=0;if(!isNaN(e.value.sellingPrice)&&!isNaN(e.value.discount)){const o=Number(e.value.systemPrice),f=Number((Number(e.value.discount)/100).toFixed(2)),m=Number(e.value.sellingPrice)*(1-f);t=Number(m-o)}return t.toFixed(2)}),j=()=>{const t=Number(e.value.systemPrice),o=Number((Number(e.value.percent)/100).toFixed(2));e.value.sellingPrice=Number((t+t*o).toFixed(2))},X=()=>{const t=Number(e.value.percent),o=Number(e.value.discount);let f=!1;if(!isNaN(t)){const m=/^\+?[1-9][0-9]*$/;if(!m.test(String(t)))return r(l("\u767E\u5206\u6BD4\u5FC5\u987B\u4E3A\u6B63\u6574\u6570")),!0;if(o&&!m.test(String(o)))return r(l("\u6298\u6263\u6BD4\u4F8B\u5FC5\u987B\u4E3A\u6B63\u6574\u6570")),!0;t>d.max&&(console.log("12"),e.value.percent=d.max,f=!0,j()),t<d.min&&(console.log("33"),e.value.percent=d.min,f=!0,j())}return f&&d.min&&d.max&&r(l("\u767E\u5206\u6BD4\u8BBE\u7F6E\u8303\u56F4\u4E3A")+`\uFF1A${d.min}% ~ ${d.max}%`),f},ce=()=>{const t=Number(e.value.sellingPrice),o=Number(e.value.systemPrice),f=Number(((t-o)/o*100).toFixed(2));e.value.percent=f};return(t,o)=>{const f=Ne,m=Re,b=Oe,v=Je,_=Pe,q=Ge,Z=$e,ee=Ue,de=je;return w(),U("div",Ae,[s(f,{fixed:""},{title:g(()=>[u("div",null,p(t.$t("\u7F16\u8F91\u5546\u54C1")),1)]),_:1}),u("div",{class:we(["edit-product-pop",{"is-ar":T(R)}])},[i(`        <div class="title">{{$t('\u7F16\u8F91\u5546\u54C1')}}</div>`),s(de,null,{default:g(()=>[u("div",Ke,p(t.$t("\u5F53\u524D\u552E\u4EF7")),1),s(b,{class:"input-field",inset:""},{default:g(()=>[i(` <van-field v-model="fromData.discountPrice" readonly :placeholder="$t('\u5F53\u524D\u552E\u4EF7')"> `),s(m,{modelValue:e.value.sellingPrice,"onUpdate:modelValue":o[0]||(o[0]=a=>e.value.sellingPrice=a),type:"number",placeholder:t.$t("\u5F53\u524D\u552E\u4EF7"),onInput:ce},{button:g(()=>[i(` <span class="profit">{{$t('\u5229\u6DA6')}} {{ (fromData.discountPrice - fromData.systemPrice).toFixed(2) }}</span> `),u("span",Qe,p(t.$t("\u5229\u6DA6"))+" "+p(T(re)),1)]),_:1},8,["modelValue","placeholder"])]),_:1}),T(k)?i("v-if",!0):(w(),U("div",We,[u("div",null,p(t.$t("\u662F\u5426\u4E0A\u67B6")),1),u("div",Xe,[s(v,{modelValue:e.value.isShelf,"onUpdate:modelValue":o[1]||(o[1]=a=>e.value.isShelf=a),size:"25","inactive-color":"#fff","inactive-value":0,"active-value":1},null,8,["modelValue"])])])),u("div",Ze,[u("div",null,p(t.$t("\u662F\u5426\u63A8\u8350")),1),u("div",et,[s(v,{modelValue:e.value.recTime,"onUpdate:modelValue":o[2]||(o[2]=a=>e.value.recTime=a),"inactive-value":0,"active-value":1,size:"25","inactive-color":"#fff"},null,8,["modelValue"])])]),i(`          <div class="tip pt-2 pb-2 pl-4 pr-4" v-if="fromData.isRecommend">{{$t('\u63A8\u8350\u65F6\u95F4')}}</div>`),i('          <van-cell-group v-if="fromData.isRecommend" class="input-field" inset>'),i(`            <van-field @click-input="onClick(3)"  v-model="fromData.recTime" :placeholder="t('\u63A8\u8350\u65F6\u95F4')">`),i("            </van-field>"),i("          </van-cell-group>"),i('          <van-popup v-model:show="isRecommendShow"'),i("                     round"),i('                     position="bottom"'),i("          >"),i("            <van-datetime-picker"),i(`                :confirm-button-text="$t('\u786E\u5B9A')"`),i(`                :cancel-button-text="$t('\u53D6\u6D88')"`),i('                v-model="recommendTime"'),i('                type="datetime"'),i(`                :title="t('\u9009\u62E9\u5B8C\u6574\u65F6\u95F4')"`),i('                @confirm="onConfirm(3)"'),i('                @cancel="onCancel(3)"'),i("            />"),i("          </van-popup>"),u("div",tt,[u("div",null,p(t.$t("\u76F4\u901A\u8F66")),1),u("div",ot,[s(v,{loading:C.value,modelValue:e.value.isCombo,"onUpdate:modelValue":o[3]||(o[3]=a=>e.value.isCombo=a),size:"25","inactive-color":"#fff"},null,8,["loading","modelValue"])])]),u("div",lt,p(t.$t("\u767E\u5206\u6BD4")),1),s(b,{class:"input-field",inset:""},{default:g(()=>[s(m,{modelValue:e.value.percent,"onUpdate:modelValue":o[4]||(o[4]=a=>e.value.percent=a),type:"number",placeholder:T(l)("\u767E\u5206\u6BD4"),rules:[{required:!0,message:T(l)("\u8BF7\u586B\u5199\u767E\u5206\u6BD4"),max:d.max,min:d.min}],onInput:j,onBlur:X},{button:g(()=>[at]),_:1},8,["modelValue","placeholder","rules"])]),_:1}),u("div",nt,[J(p(t.$t("\u5C06\u9009\u4E2D\u7684\u5546\u54C1\u53D1\u5E03\u5230\u4F60\u7684\u5E97\u94FA\uFF0C\u5E76\u586B\u5199\u5546\u54C1\u5229\u6DA6\u6BD4\u4F8B\uFF0C\u63A8\u8350\u6BD4\u4F8B"))+": ",1),u("span",null,p(d.min)+"%-"+p(d.max)+"%",1)]),u("div",it,p(t.$t("\u6298\u6263\u5F00\u59CB\u65E5\u671F")),1),s(b,{class:"input-field",inset:"",style:{position:"relative"}},{default:g(()=>[e.value.startTime?(w(),U("div",{key:0,class:"time-clear",onClick:o[5]||(o[5]=a=>e.value.startTime="")},[s(_,{name:"cross"})])):i("v-if",!0),s(m,{onClickInput:o[6]||(o[6]=a=>K(1)),modelValue:e.value.startTime,"onUpdate:modelValue":o[7]||(o[7]=a=>e.value.startTime=a),placeholder:T(l)("\u6298\u6263\u5F00\u59CB\u65E5\u671F")},null,8,["modelValue","placeholder"]),s(Z,{show:y.value,"onUpdate:show":o[11]||(o[11]=a=>y.value=a),round:"",position:"bottom"},{default:g(()=>[s(q,{"min-date":D.value,"confirm-button-text":t.$t("\u786E\u5B9A"),"cancel-button-text":t.$t("\u53D6\u6D88"),modelValue:I.value,"onUpdate:modelValue":o[8]||(o[8]=a=>I.value=a),type:"date",title:T(l)("\u9009\u62E9\u5B8C\u6574\u65F6\u95F4"),onConfirm:o[9]||(o[9]=a=>Q(1)),onCancel:o[10]||(o[10]=a=>W(1))},null,8,["min-date","confirm-button-text","cancel-button-text","modelValue","title"])]),_:1},8,["show"])]),_:1}),u("div",st,p(t.$t("\u6298\u6263\u7ED3\u675F\u65E5\u671F")),1),s(b,{class:"input-field",inset:"",style:{position:"relative"}},{default:g(()=>[e.value.endTime?(w(),U("div",{key:0,class:"time-clear",onClick:o[12]||(o[12]=a=>e.value.endTime="")},[s(_,{name:"cross"})])):i("v-if",!0),s(m,{onClickInput:o[13]||(o[13]=a=>K(2)),modelValue:e.value.endTime,"onUpdate:modelValue":o[14]||(o[14]=a=>e.value.endTime=a),placeholder:T(l)("\u6298\u6263\u7ED3\u675F\u65E5\u671F")},null,8,["modelValue","placeholder"])]),_:1}),u("div",ut,p(t.$t("\u6298\u6263\u6BD4\u4F8B")),1),s(b,{class:"input-field",inset:""},{default:g(()=>[s(m,{modelValue:e.value.discount,"onUpdate:modelValue":o[15]||(o[15]=a=>e.value.discount=a),type:"number",placeholder:T(l)("\u6298\u6263\u6BD4\u4F8B")},{button:g(()=>[rt]),_:1},8,["modelValue","placeholder"])]),_:1}),s(Z,{show:$.value,"onUpdate:show":o[19]||(o[19]=a=>$.value=a),round:"",position:"bottom"},{default:g(()=>[s(q,{"min-date":D.value,"cancel-button-text":t.$t("\u53D6\u6D88"),"confirm-button-text":t.$t("\u786E\u5B9A"),modelValue:z.value,"onUpdate:modelValue":o[16]||(o[16]=a=>z.value=a),type:"date",title:T(l)("\u9009\u62E9\u5B8C\u6574\u65F6\u95F4"),onConfirm:o[17]||(o[17]=a=>Q(2)),onCancel:o[18]||(o[18]=a=>W(2))},null,8,["min-date","cancel-button-text","confirm-button-text","modelValue","title"])]),_:1},8,["show"]),u("div",ct,[s(ee,{class:"btn-content",block:"",type:"primary",onClick:se,"native-type":"submit"},{default:g(()=>[J(p(t.$t("\u4FDD\u5B58")),1)]),_:1}),T(O)?i("v-if",!0):(w(),De(ee,{key:0,style:{"margin-top":"16px","background-color":"red","border-radius":"4px","border-color":"red"},block:"",type:"primary",onClick:Ie(P,["stop"]),"native-type":"submit"},{default:g(()=>[J(p(t.$t("\u5220\u9664")),1)]),_:1},8,["onClick"]))])]),_:1})],2)])}}},Vt=Te(dt,[["__scopeId","data-v-47e02415"],["__file","D:/caishen/mall-app-h5-vue/mall-app-h5-vue/src/views/product/components/productEdit.vue"]]);export{Vt as default};
