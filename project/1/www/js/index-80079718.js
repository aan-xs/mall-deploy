import{D as K,ae as L,a5 as Z,d as V,K as q,be as J,e as i,I as F,O as X,aF as D,a0 as $,bh as H,E as z,a6 as S,J as I,Z as P,bo as Q,r as W,aO as Y,aa as ee,bK as ae,a4 as ne,aZ as k,ag as te,p as le,P as ie}from"./index-a2850886.js";import{I as re}from"./index-4a426b76.js";import{I as oe}from"./index-db210e97.js";const[se,r,ce]=K("uploader");function U(e,n){return new Promise(o=>{if(n==="file"){o();return}const c=new FileReader;c.onload=v=>{o(v.target.result)},n==="dataUrl"?c.readAsDataURL(e):n==="text"&&c.readAsText(e)})}function O(e,n){return L(e).some(o=>o.file?Z(n)?n(o.file):o.file.size>n:!1)}function ue(e,n){const o=[],c=[];return e.forEach(v=>{O(v,n)?c.push(v):o.push(v)}),{valid:o,invalid:c}}const de=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg)/i,fe=e=>de.test(e);function B(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?fe(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var ve=V({props:{name:q,item:J(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:n,slots:o}){const c=()=>{const{status:t,message:u}=e.item;if(t==="uploading"||t==="failed"){const w=t==="failed"?i(F,{name:"close",class:r("mask-icon")},null):i(X,{class:r("loading")},null),f=$(u)&&u!=="";return i("div",{class:r("mask")},[w,f&&i("div",{class:r("mask-message")},[u])])}},v=t=>{const{name:u,item:w,index:f,beforeDelete:x}=e;t.stopPropagation(),H(x,{args:[w,{name:u,index:f}],done:()=>n("delete")})},m=()=>n("preview"),b=()=>{if(e.deletable&&e.item.status!=="uploading"){const t=o["preview-delete"];return i("div",{role:"button",class:r("preview-delete",{shadow:!t}),tabindex:0,"aria-label":ce("delete"),onClick:v},[t?t():i(F,{name:"cross",class:r("preview-delete-icon")},null)])}},h=()=>{if(o["preview-cover"]){const{index:t,item:u}=e;return i("div",{class:r("preview-cover")},[o["preview-cover"](z({index:t},u))])}},y=()=>{const{item:t,lazyLoad:u,imageFit:w,previewSize:f}=e;return B(t)?i(oe,{fit:w,src:t.content||t.url,class:r("preview-image"),width:Array.isArray(f)?f[0]:f,height:Array.isArray(f)?f[1]:f,lazyLoad:u,onClick:m},{default:h}):i("div",{class:r("file"),style:D(e.previewSize)},[i(F,{class:r("file-icon"),name:"description"},null),i("div",{class:[r("file-name"),"van-ellipsis"]},[t.file?t.file.name:t.url]),h()])};return()=>i("div",{class:r("preview")},[y(),c(),b()])}});const me={name:S(""),accept:I("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:S(1/0),imageFit:I("cover"),resultType:I("dataUrl"),uploadIcon:I("photograph"),uploadText:String,deletable:P,afterRead:Function,showUpload:P,modelValue:Q(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:P,previewOptions:Object,previewFullImage:P,maxSize:{type:[Number,String,Function],default:1/0}};var ge=V({name:se,props:me,emits:["delete","oversize","click-upload","close-preview","click-preview","update:modelValue"],setup(e,{emit:n,slots:o}){const c=W(),v=[],m=(a=e.modelValue.length)=>({name:e.name,index:a}),b=()=>{c.value&&(c.value.value="")},h=a=>{if(b(),O(a,e.maxSize))if(Array.isArray(a)){const l=ue(a,e.maxSize);if(a=l.valid,n("oversize",l.invalid,m()),!a.length)return}else{n("oversize",a,m());return}a=le(a),n("update:modelValue",[...e.modelValue,...L(a)]),e.afterRead&&e.afterRead(a,m())},y=a=>{const{maxCount:l,modelValue:d,resultType:s}=e;if(Array.isArray(a)){const g=+l-d.length;a.length>g&&(a=a.slice(0,g)),Promise.all(a.map(p=>U(p,s))).then(p=>{const _=a.map((G,A)=>{const R={file:G,status:"",message:""};return p[A]&&(R.content=p[A]),R});h(_)})}else U(a,s).then(g=>{const p={file:a,status:"",message:""};g&&(p.content=g),h(p)})},t=a=>{const{files:l}=a.target;if(e.disabled||!l||!l.length)return;const d=l.length===1?l[0]:[].slice.call(l);if(e.beforeRead){const s=e.beforeRead(d,m());if(!s){b();return}if(ne(s)){s.then(g=>{y(g||d)}).catch(b);return}}y(d)};let u;const w=()=>n("close-preview"),f=a=>{if(e.previewFullImage){const l=e.modelValue.filter(B),d=l.map(s=>(s.file&&!s.url&&s.status!=="failed"&&(s.url=URL.createObjectURL(s.file),v.push(s.url)),s.url)).filter(Boolean);u=re(z({images:d,startPosition:l.indexOf(a),onClose:w},e.previewOptions))}},x=()=>{u&&u.close()},j=(a,l)=>{const d=e.modelValue.slice(0);d.splice(l,1),n("update:modelValue",d),n("delete",a,m(l))},E=(a,l)=>{const d=["imageFit","deletable","previewSize","beforeDelete"],s=z(k(e,d),k(a,d,!0));return i(ve,te({item:a,index:l,onClick:()=>n("click-preview",a,m(l)),onDelete:()=>j(a,l),onPreview:()=>f(a)},k(e,["name","lazyLoad"]),s),k(o,["preview-cover","preview-delete"]))},N=()=>{if(e.previewImage)return e.modelValue.map(E)},C=a=>n("click-upload",a),M=()=>{if(e.modelValue.length>=e.maxCount||!e.showUpload)return;const a=e.readonly?null:i("input",{ref:c,type:"file",class:r("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:t},null);return o.default?i("div",{class:r("input-wrapper"),onClick:C},[o.default(),a]):i("div",{class:r("upload",{readonly:e.readonly}),style:D(e.previewSize),onClick:C},[i(F,{name:e.uploadIcon,class:r("upload-icon")},null),e.uploadText&&i("span",{class:r("upload-text")},[e.uploadText]),a])},T=()=>{c.value&&!e.disabled&&c.value.click()};return Y(()=>{v.forEach(a=>URL.revokeObjectURL(a))}),ee({chooseFile:T,closeImagePreview:x}),ae(()=>e.modelValue),()=>i("div",{class:r()},[i("div",{class:r("wrapper",{disabled:e.disabled})},[N(),M()])])}});const he=ie(ge);export{he as U};
