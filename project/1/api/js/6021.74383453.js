"use strict";(self["webpackChunkshop"]=self["webpackChunkshop"]||[]).push([[6021],{46021:function(t,e,i){i.r(e),i.d(e,{default:function(){return u}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bank_card"},[e("van-nav-bar",{attrs:{"safe-area-inset-top":"",fixed:"",title:"Hive"==t.itemName?t.$t("加值"):t.$t("充值"),"left-arrow":"","right-text":t.$t("记录")},on:{"click-left":function(e){return t.$router.push({path:"/rechargeList",dir:"left"})},"click-right":function(e){return t.$router.push({path:"/rechargeRecord"})}}}),e("div",{staticClass:"h46",staticStyle:{width:"100%"}}),e("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[t.isGcash?t._e():e("el-form-item",{attrs:{label:t.$t("选择币种")}},[e("el-select",{attrs:{placeholder:t.$t("请选择币种"),filterable:"","no-match-text":t.$t("无匹配数据")},on:{change:t.handleChange},model:{value:t.form.currency,callback:function(e){t.$set(t.form,"currency",e)},expression:"form.currency"}},t._l(t.coinList,(function(t){return e("el-option",{key:t.bank_code,attrs:{label:t.bank_code,value:t.bank_code}})})),1)],1),e("el-form-item",{attrs:{label:t.$t("充值金额")}},[e("el-input",{attrs:{type:"number",step:"0.01",placeholder:`${t.min}-${t.max}`,clearable:""},on:{input:t.handleInput,change:t.handleInputChange},model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}})],1)],1),e("div",{staticClass:"btn"},[e("van-button",{attrs:{block:"",type:"primary",disabled:t.btnDis},on:{click:t.onSubmit}},[t._v(t._s(t.$t("确认")))])],1),e("van-popup",{model:{value:t.showPopup,callback:function(e){t.showPopup=e},expression:"showPopup"}},[e("div",{staticClass:"popup_wrap"},[e("div",{staticClass:"title"},[t._v(" "+t._s(t.$t("请前往"))+t._s(t.payName)+"，"+t._s(t.$t("继续完成支付"))+" ")]),e("div",{staticClass:"path"},[t._v(" "+t._s(t.path)+" ")]),e("div",{staticClass:"btn"},[e("van-button",{attrs:{type:"primary"},on:{click:t.handleAccess}},[t._v(t._s(t.$t("继续访问")))])],1)])])],1)},a=[],n=(i(60836),i(46811)),r=(i(37850),i(88848)),o=i(90925),c=i(14970),h={components:{[r.Z.name]:r.Z,[n.Z.name]:n.Z},data(){return{itemName:"TikTokMall",coinList:[],max:"",min:"",form:{currency:"",price:""},session_token:"",btnDis:!0,isGcash:!0,showPopup:!1,path:""}},computed:{payName(){return"Maya"==this.$route.query?.type?"Maya":"GCash"}},async created(){(0,c.BX)({}).then((t=>{this.session_token=t.session_token}));const{type:t,min:e,max:i}=this.$route.query;if(this.isGcash="Bank"!=t,"Bank"==t){r.Z.loading({message:this.$t("加载中..."),forbidClick:!0,duration:0});try{const e=await(0,o.SZ)();this.coinList=e.filter((e=>e.productType==t))[0].range,this.form.currency=this.coinList[27].bank_code,this.max=this.coinList[27].max_amount,this.min=this.coinList[27].min_amount,r.Z.clear()}catch(s){r.Z.clear(),this.$router.back()}}else this.max=i,this.min=e},methods:{async onSubmit(){if(this.$toast.loading(),""==this.form.price)return this.$notify(this.$t("请输入充值数量"));if(await(0,c.BX)({}).then((t=>{this.session_token=t.session_token})),this.isGcash){const t={"GCash2.0":o.OQ,"GCash3.0":o.eL,Maya:o._2,"GCash pay":o.mx},e=t[this.$route.query?.type]||o.V$,i={amount:this.form.price,session_token:this.session_token,token:localStorage.getItem("token")};["GCash2.0","GCash3.0","Maya","GCash pay"].includes(this.$route.query?.type)&&(i.pageUrl=window.location.href.split("#/")[0]+"#/me");const s=await e(i);window?.plus?plus.runtime.openURL(encodeURI(s+"?wt=app")):this.isIos()?(this.path=s,this.showPopup=!0):window.open(s)}else{const t=await(0,o.J$)({amount:this.form.price,frenchCurrency:this.form.currency,session_token:this.session_token});window?.plus?plus.runtime.openURL(encodeURI(t+"?wt=app")):this.isIos()?(this.path=t,this.showPopup=!0):window.open(t)}this.$toast.clear()},isIos(){const t=navigator.userAgent;return!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)},handleChange(t){this.form.price="";const e=this.coinList.filter((e=>e.bank_code==t));this.max=e[0].max_amount,this.min=e[0].min_amount},handleInput(){this.form.price=this.form.price.replace(/[^\d.]/g,""),this.form.price=this.form.price.replace(/\.{2,}/g,"."),this.form.price=this.form.price.replace(/^\./g,""),this.form.price=this.form.price.replace(".","$#$").replace(/\./g,"").replace("$#$","."),this.form.price=this.form.price.replace(/^(\-)*(\d+)\.(\d{0,2}).*$/,"$1$2.$3"),this.form.price>this.max?this.form.price=this.max:this.form.price<1&&(this.form.price=""),this.btnDis=this.form.price<this.min},handleInputChange(){if(this.form.price<this.min)return this.form.price="",void this.$notify(`${this.$t("申请金额不能小于")}${this.min}`);this.form.price=Number(this.form.price).toFixed(2)},async handleGcashQuery(t){const e=await(0,o.SZ)(t);return e[0]},handleAccess(){this.showPopup=!1,window.open(this.path)}}},p=h,l=i(1001),m=(0,l.Z)(p,s,a,!1,null,"8838f13e",null),u=m.exports},60836:function(t,e,i){i(22184),i(74048),i(14106),i(4127),i(44174)}}]);